# Replacing HA Certificates<a name="EN-US_TOPIC_0221415064"></a>

## Scenario<a name="section27934550113125"></a>

HA certificates are used to encrypt the communication between active/standby processes and high availability processes to ensure security. Replace the HA certificates on active and standby management nodes on MRS Manager to ensure product security.

The certificate file and key file can be generated by the users.

## Impact on the System<a name="section35503302113216"></a>

The MRS Manager system must be restarted during the replacement and cannot be accessed or provide services.

## Prerequisites<a name="section47013901113220"></a>

-   You have obtained the  **root-ca.crt** root file and the **root-ca.pem**  key file of the certificate to be replaced.
-   You have prepared a password, for example,  **Userpwd@123**, for accessing the key file.

    The password must meet the following complexity requirements. Otherwise, security risks may be incurred.

    -   The password must contain at least eight characters.
    -   The password must contain at least four types of the following: uppercase letters, lowercase letters, digits, and special characters \~\`!?,.:;-\_'\(\)\{\}\[\]/<\>@\#$%^&\*+|\\=.


## Procedure<a name="section66354921113232"></a>

1.  Log in to the active management node.
2.  Run the following command to switch the user:

    **sudo su - root**

    **su - omm**

3.  Run the following command to generate  **root-ca.crt** and **root-ca.pem** in the **$\{OMS\_RUN\_PATH\}/workspace0/ha/local/cert**  directory:

    **sh $\{OMS\_RUN\_PATH\}/workspace/ha/module/hacom/script/gen-cert.sh --root-ca --country=**_country_ **--state=**_state_ **--city=**_city_ **--company=**_company_ **--organize=**_organize_ **--common-name=**_commonname_ **--email=**_Administrator email_ **address --password=**_**password**_

    For example, run the following command to generate the files:  **sh $\{OMS\_RUN\_PATH\}/workspace/ha/module/hacom/script/gen-cert.sh --root-ca --country=DE --state=eur --city=ber --company=dt --organize=IT --common-name=HADOOP.COM --email=abc@dt.com --password=Userpwd@123**

    If the following information is displayed, the command is executed successfully:

    ```
    Generate root-ca pair success.
    ```

4.  On the active management node, run the following command as user  **omm** to copy **root-ca.crt**  and **root-ca.pem** to the **$\{BIGDATA\_HOME\}/om-0.0.1/security/certHA**  directory:

    **cp -arp $\{OMS\_RUN\_PATH\}/workspace0/ha/local/cert/root-ca.\* $\{BIGDATA\_HOME\}/om-0.0.1/security/certHA**

5.  Copy  **root-ca.crt** and **root-ca.pem** generated on the active management node to **$\{BIGDATA\_HOME\}/om-0.0.1/security/certHA** on the standby management node as user **omm**.

    **scp $\{BIGDATA\_HOME\}/om-0.0.1/security/certHA/root-ca.\* omm@standby management node IP:$\{BIGDATA\_HOME\}/om-0.0.1/security/certHA**

6.  <a name="li61539631113353"></a>Run the following command to generate an HA certificate and perform automatic replacement:

    **sh $\{BIGDATA\_HOME\}/om-0.0.1/sbin/replacehaSSLCert.sh**

    Enter password as prompted and press  **Enter**.

    ```
    Please input ha ssl cert password:
    ```

    If the following information is displayed, the HA certificate is replaced successfully:

    ```
    [INFO] Succeed to replace ha ssl cert.
    ```

7.  <a name="li61839614113353"></a>Run the following command to restart OMS.

    **sh $\{BIGDATA\_HOME\}/om-0.0.1/sbin/restart-oms.sh**

    The following information is displayed:

    ```
    start HA successfully.
    ```

8.  Log in to the standby management node and switch to user  **omm**. Repeat [6](#li61539631113353) to [7](#li61839614113353).

    Run the  **sh $\{BIGDATA\_HOME\}/om-0.0.1/sbin/status-oms.sh** command to check whether **HAAllResOK** of the management node is **Normal**. Access the MRS Manager again. If MRS Manager can be accessed, the operation is successful.


