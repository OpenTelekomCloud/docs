# Configuring a Static Service Pool<a name="EN-US_TOPIC_0125376104"></a>

## Scenario<a name="section36446384185849"></a>

Users can adjust the resource base on MRS Manager and customize a resource configuration group to control the node resources used by cluster services or specify different node CPUs for cluster services at different periods.

## Prerequisites<a name="section41676267185911"></a>

-   After a static service pool is configured, the HDFS and Yarn services need to be restarted. The services are unavailable during restart.
-   After a static service pool is configured, the maximum amount of resources used by the services and their role instances cannot exceed the threshold.

## Procedure<a name="section1786339185927"></a>

1.  Modify the resource adjustment base.
    1.  On MRS Manager, click  **System**. In the **Resource** area, click **Configure** **Static Service Pool**.
    2.  Click  **Configuration**. The management page of the service pool configuration group is displayed.
    3.  In  **System Resource Adjustment Base**, modify parameters **CPU\(%\)**  and  **Memory\(%\)**.

        You can restrict the maximum number of physical CPUs and memory resources that can be used by the HBase, HDFS, and Yarn services. If multiple services are deployed on the same node, the maximum percentage of physical resources  used by all services cannot exceed the value of this parameter.

    4.  Click  **OK** to complete the modification.

        To modify the parameters again, click ![](figures/icon_mrs_clip.gif) on the right side of **System Resource Adjustment Base**.

2.  Modify the  **default**  configuration group of the service pool.

    1.  Click  **default**, and set **CPU LIMIT\(%\)**, **CPU SHARE\(%\)**, **I/O\(%\)**, and **Memory\(%\)** for the HBase, HDFS, and Yarn services in the **Service Pool Configuration**  table.

    >![](/images/icon-note.gif) **NOTE:**   
    >-   The sum of  **CPU LIMIT\(%\)**  used by all services can exceed 100%.  
    >-   The sum of  **CPU SHARE\(%\)** and the sum of **I/O\(%\)** used by all services must be 100%. For example, if CPU resources are allocated to the HDFS, HBase and Yarn services, the total percentage of the CPU resources allocated to the services must be 100%.  
    >-   The sum of  **Memory\(%\)** used by all services can be greater than, smaller than, or equal to 100%.  
    >-   **Memory\(%\)** cannot take effect dynamically. This parameter can only be modified in the **default**  configuration group.  

    1.  Click  **OK**  to complete the modification. The correct values of the service pool parameters are generated by MRS Manager in **Detailed Configuration** based on cluster hardware resources and distribution.

        To modify the parameters again, click ![](figures/icon_mrs_clip.gif) on the right side of **Service Pool Configuration**.

    2.  Click  ![](figures/icon_mrs_clip.gif) on the right side of **Detailed Configuration** to change the parameter values of the service pool.

        After you click the name of a specified service in  **Service Pool Configuration**, only the parameters of this service will be displayed in **Detailed Configuration**. The displayed resource usage will not be updated by changing the parameter values manually. For parameters that take effect dynamically, their names displayed in a newly added configuration group will contain the ID of the configuration group, for example, **HBase : RegionServer : dynamic-config1.RES\_CPUSET\_PERCENTAGE**. The parameters function in the same way as those in the **default**  configuration group.

        **Table  1**  Static service pool parameters

        <a name="table1090518719336"></a>
        <table><thead align="left"><tr id="row6120169419340"><th class="cellrowborder" valign="top" width="46.5%" id="mcps1.2.3.1.1"><p id="p5839019519340"><a name="p5839019519340"></a><a name="p5839019519340"></a><strong id="b4481984310443"><a name="b4481984310443"></a><a name="b4481984310443"></a>Parameter</strong></p>
        </th>
        <th class="cellrowborder" valign="top" width="53.5%" id="mcps1.2.3.1.2"><p id="p3198534019340"><a name="p3198534019340"></a><a name="p3198534019340"></a><strong id="b56923026175048"><a name="b56923026175048"></a><a name="b56923026175048"></a>Description</strong></p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row3085288319336"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><a name="ul658374017505"></a><a name="ul658374017505"></a><ul id="ul658374017505"><li><strong id="b52474816175011"><a name="b52474816175011"></a><a name="b52474816175011"></a>RES_CPUSET_PERCENTAGE</strong></li><li><strong id="b35656696175011"><a name="b35656696175011"></a><a name="b35656696175011"></a>dynamic-configX.RES_CPUSET_PERCENTAGE</strong></li></ul>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p1503453917505"><a name="p1503453917505"></a><a name="p1503453917505"></a>Specifies the CPU percentage used by a service.</p>
        </td>
        </tr>
        <tr id="row1860108319336"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><a name="ul2143459017505"></a><a name="ul2143459017505"></a><ul id="ul2143459017505"><li><strong id="b6459064175013"><a name="b6459064175013"></a><a name="b6459064175013"></a>RES_CPU_SHARE</strong></li><li><strong id="b45456916175013"><a name="b45456916175013"></a><a name="b45456916175013"></a>dynamic-configX.RES_CPU_SHARE</strong></li></ul>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p34797873175019"><a name="p34797873175019"></a><a name="p34797873175019"></a>Specifies the CPU share used by a service.</p>
        </td>
        </tr>
        <tr id="row3584786119336"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><a name="ul1443452617505"></a><a name="ul1443452617505"></a><ul id="ul1443452617505"><li><strong id="b13996221175015"><a name="b13996221175015"></a><a name="b13996221175015"></a>RES_BLKIO_WEIGHT</strong></li><li><strong id="b31381297175015"><a name="b31381297175015"></a><a name="b31381297175015"></a>dynamic-configX.RES_BLKIO_WEIGHT</strong></li></ul>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p1923073817505"><a name="p1923073817505"></a><a name="p1923073817505"></a>Specifies the I/O weight used by a service.</p>
        </td>
        </tr>
        <tr id="row10594627174840"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><p id="p39373602174841"><a name="p39373602174841"></a><a name="p39373602174841"></a><strong id="b18818098174841"><a name="b18818098174841"></a><a name="b18818098174841"></a>HBASE_HEAPSIZE</strong></p>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p47870965174841"><a name="p47870965174841"></a><a name="p47870965174841"></a>Specifies the maximum JVM memory of RegionServer.</p>
        </td>
        </tr>
        <tr id="row2128630419336"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><p id="p9828983174854"><a name="p9828983174854"></a><a name="p9828983174854"></a><strong id="b21351989174854"><a name="b21351989174854"></a><a name="b21351989174854"></a>HADOOP_HEAPSIZE</strong></p>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p51789537174854"><a name="p51789537174854"></a><a name="p51789537174854"></a>Specifies the maximum JVM memory of DataNode.</p>
        </td>
        </tr>
        <tr id="row45613830102614"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><p id="p3732754102614"><a name="p3732754102614"></a><a name="p3732754102614"></a><strong id="b54696199102622"><a name="b54696199102622"></a><a name="b54696199102622"></a>dfs.datanode.max.locked.memory</strong></p>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p33917654102614"><a name="p33917654102614"></a><a name="p33917654102614"></a>Specifies the size of the cached memory block replica of DataNode in the memory.</p>
        </td>
        </tr>
        <tr id="row470866661944"><td class="cellrowborder" valign="top" width="46.5%" headers="mcps1.2.3.1.1 "><p id="p55989681174848"><a name="p55989681174848"></a><a name="p55989681174848"></a><strong id="b34145081174848"><a name="b34145081174848"></a><a name="b34145081174848"></a>yarn.nodemanager.resource.memory-mb</strong></p>
        </td>
        <td class="cellrowborder" valign="top" width="53.5%" headers="mcps1.2.3.1.2 "><p id="p14288183174848"><a name="p14288183174848"></a><a name="p14288183174848"></a>Specifies the memory that can be used by NodeManager on the current node.</p>
        </td>
        </tr>
        </tbody>
        </table>

3.  Add a customized resource configuration group.
    1.  Determine whether to implement time-based automatic resource configuration adjustment.

        If yes, go to  [3.b](#li207277341970).

        If no, go to  [4](#li5675506119820).

    2.  <a name="li207277341970"></a>Click  ![](figures/icon_mrs_addsource.jpg) to add a resource configuration group. In **Scheduling Time**, click ![](figures/icon_mrs_clip.gif)  to open the time policy configuration page.

        Modify the following parameters and click **OK**  to save the modification.

        -   **Repeat**: If **Repeat** is selected, the resource configuration group runs periodically according to a schedule. If **Repeat** is not selected, you need to set a date and time for the resource configuration group to take effect.
        -   **Repeat On**: **Daily**, **Weekly**, and **Monthly**  are supported. This parameter takes effect only in **Repeat**  mode.
        -   **Between**: This parameter specifies the start time and end time for the resource configuration group to take effect. Set this parameter to a unique time segment. If the value is the same as the time segment set for an existing configuration group, the settings cannot be saved. This parameter takes effect only in **Repeat**  mode.

        >![](/images/icon-note.gif) **NOTE:**   
        >-   The  **default**  configuration group takes effect in all undefined time periods.  
        >-   The newly added configuration group is a configuration item set that takes effect dynamically in a specified time range.  
        >-   The newly added configuration group can be deleted. A maximum of four configuration groups that take effect dynamically can be added.  
        >-   Select any type of  **Repeat On**. If the end time is earlier than the start time, the end time on the second day is adopted by default. For example, 22:00 to 6:00 indicates that the scheduling time range is from **22:00** on the current day to **06:00**  on the next day.  
        >-   If the types of  **Repeat On** for multiple configuration groups are different, the time segments can overlap.  **Monthly**  has the highest priority of the policies,  **Weekly**  has the second highest, and  **Daily**  has the lowest. Therefore, if there are two scheduling configuration groups, and one is  **Monthly**  with a time segment from 04:00 to 07:00, and the other is  **Daily**  with a time segment from 06:00 to 08:00, the  **Monthly** configuration group takes precedence.  
        >-   If the types of  **Repeat On** for multiple configuration groups are the same, the time segments can overlap when the dates are different. For example, if two **Weekly**  scheduling configuration groups exist, the time segments can be specified from 04:00 to 07:00 on Monday and 04:00 to 07:00 on Wednesday.  

    3.  Modify the resource configuration of each service in  **Service Pool Configuration**, click **OK**, and go to [4](#li5675506119820).

        You can click  ![](figures/icon_mrs_clip.gif) to modify the parameters again. You can click ![](figures/icon_mrs_clip.gif) in **Detailed Configuration**  to manually update the parameter values generated by the system based on service requirements.

4.  <a name="li5675506119820"></a>Save the configuration.

    Click  **Save**, select **Restart the affected services or instances** in the **Save Configuration** window, and click **OK**.

    When  **Operation succeeded**  is displayed, click **Finish**.


